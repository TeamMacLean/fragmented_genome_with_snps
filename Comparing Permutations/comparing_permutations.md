Methods for comparing contig permutations with a correct order
========================================================

When evaluating the output of the genetic algorithm (GATOC), we need a metric to measure the "correctness" for permutations of the contig order. This is needed to assess how well the fitness method of the algorithm works, as without an increase that is correlated to the "correctness" of contig order, the algorithm cannot be considered effective.

By comparing methods for obtaining such a metric, I aim to find one the one most appropriate for rating the performance of my algorithm.

Metric 1 (Ordinal Similarity)
----

The difference between a contig's index in the correct order and in the permutation, is calculated for each contig. Summing the differences gives an overall score, which can be described mathematically as the ordinal similarity between the two arrangements (correct and a permutation). The higher the value of the score, the lower the ordinal similarity of the permutation to the correct order. A perfect score would be 0, where the permutation being tested is correct. The better permutations generated by the genetic algorithm should have scores closer to 0.

![Image](https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/old_or_unused/figures/ordinal_similarity.png?raw=true)

where:
- a = (1...n)  The array of unique objects
- i = each element of a
- F = the function used to generate the rearranged order

Metric 2
------

A new vector is created from the permutation by counting from the position of the first contig (from the correct order) onwards, then adding the rest of the permutation (before the first) to the end of the new vector e.g. [4,3,1,2,5] would translate to [1,2,5,4,3]. The hamming distance for new vector is determined by comparing against the correct order e.g. [1,2,5,4,3] would have a hamming distance of 2 (where [1,2,3,4,5] is the correct order). This hamming distance is then added to the position of the first contig in the permutation minus one (e.g. 2 for [4,3,1,2,5]), to give the final score = 2 + 2 = 4.

GIVE EQUATION

Comparing metrics
----

Below are sparse matrices for all the possible permutations of 3 unique ordered objects (in this case, the integers 1,2 and 3). For each of these permutations I will assign values attributed by the "correctness" metrics.


```r
library("Matrix", lib.loc = "/Library/Frameworks/R.framework/Versions/3.0/Resources/library")
```

```
## Loading required package: lattice
```

```r
# Metric 1: 0 Metric 2: 0
as(c(1, 2, 3), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] | . .
## [2,] . | .
## [3,] . . |
```

```r

# Metric 1: 2 Metric 2: 2
as(c(1, 3, 2), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] | . .
## [2,] . . |
## [3,] . | .
```

```r

# Metric 1: 2 Metric 2: 3
as(c(2, 1, 3), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] . | .
## [2,] | . .
## [3,] . . |
```

```r

# Metric 1: 4 Metric 2: 2
as(c(2, 3, 1), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] . | .
## [2,] . . |
## [3,] | . .
```

```r

# Metric 1: 4 Metric 2: 1
as(c(3, 1, 2), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] . . |
## [2,] | . .
## [3,] . | .
```

```r

# Metric 1: 4 Metric 2: 4
as(c(3, 2, 1), "pMatrix")
```

```
## 3 x 3 sparse Matrix of class "pMatrix"
##           
## [1,] . . |
## [2,] . | .
## [3,] | . .
```


The first matrix above shows the correct permutation. The closer each of the other matrices is to the diagonal of ones, the "closer" the permutation must be to the correct order. The degree of "closeness" is what I am trying to establish by providing these metrics. One thing is certain, the reversed permutation ([3,2,1] here) should give the worst possible score, because it is the exact opposite of the correct order. Whilst this is the case for both metric 1 and 2, metric 1 also attributes the same score to two other permutations. Metric 2 takes into account the fact that parts of a permutation may be in consectutive order (objects within a part correctly positioned in relation to eachother), whilst out of step with their correct position in the perfect order. For example, the [2,3,1] and [3,1,2] matrices above have a better metric 2 score than [2,1,3], because they have 2,3 and 1,2 consecutively within them respectively.

Other Metrics
--------

[Sevaux and Kenneth (2005)](http://www.researchgate.net/publication/228565454_Permutation_distance_measures_for_memetic_algorithms_with_population_management/file/d912f50a9de08542ff.pdf) describe a number of other distance metrics for comparing permutations. In the table below I have compared the scores for all the permutations of 4 unique objects, for 7 different metrics. Dev is the deviation distance (this is the same as metric 1 above). Sq_dev is the squared deviation distance. Ham is the Hamming distance. Mod_ham is the modified version of Hamming distance described in metric 2 above. R is the reversed version of the R distance (so that higher scores are worse). Lcs is the longest common subsequence. Kt is Kendall's tau. Each of these metrics have been normalized so that all the values fall between 0 and 1, where 0 is a perfect match to the correct permutation (1,2,3,4), and 1 is the maximum possible distance.



```r
scores <- as.vector(as.matrix(read.table("~/fragmented_genome_with_snps/test/1-4_metric_scores.txt", 
    quote = "\"")))
perms <- as.vector(as.matrix(read.table("~/fragmented_genome_with_snps/test/1-4_perms.txt", 
    quote = "\"")))
convert <- function(perm) {
    return(strtoi(unlist(strsplit(toString(perm), split = ""))))
}
table <- round(matrix(scores, ncol = 7, byrow = TRUE), 2)  # rounded values to 2dp
colnames(table) <- c("dev", "sq_dev", "ham", "mod_ham", "r", "lcs", "kt")
rownames(table) <- perms
table <- as.table(table)
table
```

```
##       dev sq_dev  ham mod_ham    r  lcs   kt
## 1234 0.00   0.00 0.00    0.00 0.00 0.00 0.00
## 1243 0.25   0.10 0.50    0.33 0.67 0.33 0.17
## 1324 0.25   0.10 0.50    0.33 1.00 0.33 0.17
## 1342 0.50   0.30 0.75    0.50 0.67 0.33 0.33
## 1423 0.50   0.30 0.75    0.50 0.67 0.33 0.33
## 1432 0.50   0.40 0.50    0.33 1.00 0.67 0.50
## 2134 0.25   0.10 0.50    0.67 0.67 0.33 0.17
## 2143 0.50   0.20 1.00    0.50 1.00 0.67 0.33
## 2314 0.50   0.30 0.75    0.83 0.67 0.33 0.33
## 2341 0.75   0.60 1.00    0.50 0.33 0.33 0.50
## 2413 0.75   0.50 1.00    0.67 1.00 0.67 0.50
## 2431 0.75   0.70 0.75    0.83 1.00 0.67 0.67
## 3124 0.50   0.30 0.75    0.50 0.67 0.33 0.33
## 3142 0.75   0.50 1.00    0.67 1.00 0.67 0.50
## 3214 0.50   0.40 0.50    0.67 1.00 0.67 0.50
## 3241 0.75   0.70 0.75    0.83 1.00 0.67 0.67
## 3412 1.00   0.80 1.00    0.33 0.33 0.67 0.67
## 3421 1.00   0.90 1.00    1.00 0.67 0.67 0.83
## 4123 0.75   0.60 1.00    0.17 0.33 0.33 0.50
## 4132 0.75   0.70 0.75    0.50 1.00 0.67 0.67
## 4213 0.75   0.70 0.75    0.83 1.00 0.67 0.67
## 4231 0.75   0.90 0.50    1.00 0.67 0.67 0.83
## 4312 1.00   0.90 1.00    0.67 0.67 0.67 0.83
## 4321 1.00   1.00 1.00    0.83 1.00 1.00 1.00
```



```r
as(convert(perms[1]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . | . .
## [3,] . . | .
## [4,] . . . |
```

```r
convert(perms[1])
```

```
## [1] 1 2 3 4
```

```r
as(convert(perms[2]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . | . .
## [3,] . . . |
## [4,] . . | .
```

```r
perms[2]
```

```
## [1] 1243
```

```r
as(convert(perms[3]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . . | .
## [3,] . | . .
## [4,] . . . |
```

```r
perms[3]
```

```
## [1] 1324
```

```r
as(convert(perms[4]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . . | .
## [3,] . . . |
## [4,] . | . .
```

```r
perms[4]
```

```
## [1] 1342
```

```r
as(convert(perms[5]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . . . |
## [3,] . | . .
## [4,] . . | .
```

```r
perms[5]
```

```
## [1] 1423
```

```r
as(convert(perms[6]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] | . . .
## [2,] . . . |
## [3,] . . | .
## [4,] . | . .
```

```r
perms[6]
```

```
## [1] 1432
```

```r
as(convert(perms[7]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] | . . .
## [3,] . . | .
## [4,] . . . |
```

```r
perms[7]
```

```
## [1] 2134
```

```r
as(convert(perms[8]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] | . . .
## [3,] . . . |
## [4,] . . | .
```

```r
perms[8]
```

```
## [1] 2143
```

```r
as(convert(perms[9]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] . . | .
## [3,] | . . .
## [4,] . . . |
```

```r
perms[9]
```

```
## [1] 2314
```

```r
as(convert(perms[10]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] . . | .
## [3,] . . . |
## [4,] | . . .
```

```r
perms[10]
```

```
## [1] 2341
```

```r
as(convert(perms[11]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] . . . |
## [3,] | . . .
## [4,] . . | .
```

```r
perms[11]
```

```
## [1] 2413
```

```r
as(convert(perms[12]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . | . .
## [2,] . . . |
## [3,] . . | .
## [4,] | . . .
```

```r
perms[12]
```

```
## [1] 2431
```

```r
as(convert(perms[13]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] | . . .
## [3,] . | . .
## [4,] . . . |
```

```r
perms[13]
```

```
## [1] 3124
```

```r
as(convert(perms[14]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] | . . .
## [3,] . . . |
## [4,] . | . .
```

```r
perms[14]
```

```
## [1] 3142
```

```r
as(convert(perms[15]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] . | . .
## [3,] | . . .
## [4,] . . . |
```

```r
perms[15]
```

```
## [1] 3214
```

```r
as(convert(perms[16]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] . | . .
## [3,] . . . |
## [4,] | . . .
```

```r
perms[16]
```

```
## [1] 3241
```

```r
as(convert(perms[17]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] . . . |
## [3,] | . . .
## [4,] . | . .
```

```r
perms[17]
```

```
## [1] 3412
```

```r
as(convert(perms[18]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . | .
## [2,] . . . |
## [3,] . | . .
## [4,] | . . .
```

```r
perms[18]
```

```
## [1] 3421
```

```r
as(convert(perms[19]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] | . . .
## [3,] . | . .
## [4,] . . | .
```

```r
perms[19]
```

```
## [1] 4123
```

```r
as(convert(perms[20]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] | . . .
## [3,] . . | .
## [4,] . | . .
```

```r
perms[20]
```

```
## [1] 4132
```

```r
as(convert(perms[21]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] . | . .
## [3,] | . . .
## [4,] . . | .
```

```r
perms[21]
```

```
## [1] 4213
```

```r
as(convert(perms[22]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] . | . .
## [3,] . . | .
## [4,] | . . .
```

```r
perms[22]
```

```
## [1] 4231
```

```r
as(convert(perms[23]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] . . | .
## [3,] | . . .
## [4,] . | . .
```

```r
perms[23]
```

```
## [1] 4312
```

```r
as(convert(perms[24]), "pMatrix")
```

```
## 4 x 4 sparse Matrix of class "pMatrix"
##             
## [1,] . . . |
## [2,] . . | .
## [3,] . | . .
## [4,] | . . .
```

```r
perms[24]
```

```
## [1] 4321
```


Evaluating the scores for permutations of length 4 shows that metric 2 has some problems. For example, it gives (4,2,3,1) a higher score (6) than (4,3,2,1) (5), even though the former has 2/4 correctly positioned objects (2 and 3). It also gives (3,4,1,2) a very good score (2) despite none of the objects being correctly positioned; this isn't neccesarily bad, the fact that the sections (3,4) and (1,2) are ordered correctly within has been taken into account.

Averaging the scores of metric 1 and 2 has the following problem: (3,4,2,1) has a higher score (7) than (4,3,2,1) (6.5). This is bad because the (3,4) in the former permutation are correctly ordered realative to eachother.
