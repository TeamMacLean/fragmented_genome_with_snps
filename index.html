<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="GATOC (Genetic Algorithm To Order Contigs) : Model a fragmented genome with SNPs using R/Ruby" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>GATOC (Genetic Algorithm To Order Contigs)</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps">View on GitHub</a>

          <h1 id="project_title">GATOC (Genetic Algorithm To Order Contigs)</h1>
          <h2 id="project_tagline">Model a fragmented genome with SNPs using R/Ruby</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="gatoc-genetic-algorithm-to-order-contigs" class="anchor" href="#gatoc-genetic-algorithm-to-order-contigs"><span class="octicon octicon-link"></span></a>GATOC (Genetic Algorithm To Order Contigs)</h1>



<h2>
<a name="background-information" class="anchor" href="#background-information"><span class="octicon octicon-link"></span></a>Background Information</h2>

<p>Identifying the genes and alleles associated with beneficial and deleterious traits, is of the utmost importance to agronomic and biomedical science. When beneficial mutations are identified in agronomically important plant species, breeders can select for progeny with the mutant phenotype. This molecular breeding strategy speeds up the selection process, because rejected plants need not be grown. If breeders wish to enhance a complex trait, such as pathogenic disease resistance in a crop species, natural variation can be a limiting factor. One approach is to induce mutations experimentally, using mutagens such as ethylmethane sulphonate (EMS).</p>

<p>Identifying causal mutants is important in understanding the mechanism by which they confer a beneficial phenotype. Software packages like SHOREmap (Schneeberger et al, 2009) and NGM (Austin et al, 2011) have been developed, which can be used to identify causative mutations in F2 EMS mutants. NGM for example, works using a chastity statistic to quantify the relative contribution of the parental mutant, and mapping lines, to each single nucleotide polymorphism (SNP), in the pooled F2 population.</p>

<p>However, in species where a reference genome is not available, there exists a need to develop tools which can identify mutations directly from HTS datasets.</p>

<h2>
<a name="project" class="anchor" href="#project"><span class="octicon octicon-link"></span></a>Project</h2>

<p>I am creating a model genome, based of <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/TAIR10_chr4.fasta">Arabidopsis chromosome 4</a>, from an individual created by the back-crossing of a mutant with a mapping line, where the mutation is an experimentally induced, phenotype altering SNP. </p>

<p>I am designing an algorithm that can locate a causative SNP mutation, based on the distribution of SNPs. To emulate real data, I first split the genome into fragments, which model contigs assembled from high-throughput sequencing reads. My algorithm will need to rearrange these contigs into their proper order, to locate the causative mutation.</p>

<h3>
<a name="the-experiment-being-modelled" class="anchor" href="#the-experiment-being-modelled"><span class="octicon octicon-link"></span></a>The Experiment Being Modelled</h3>

<p>A beneficial Arabidopsis phenotype is created by experimentally by inducing SNPs with EMS (e.g. a disease resistance mutation). The phenotype altering, reccesive homozygous SNP needs to be identified. The mutant individual is back-crossed with a mapping line. This mapping line is a cross between two Arabidopsis ecotypes (one of which the same ecotype as the mutant), and therefore has heterozygous SNPs across its genome.</p>

<p>Back-crossing like this multiple times, but always selecting for progeny with the mutant phenotype, will result in an individual that has a non-recombinant region with high homozygous to heterozygous SNP ratio near the mutant position, due to linkage. This is because with each back-cross, the EMS induced homozygous SNPs closest to mutation being selected for have a higher chance of being conserved through linkage, than those further from the location of the mutation. </p>

<p>In other words, the remaining linked homozygous SNPs will be distributed around the phenotype causing SNP. Plotting the homozygous/heterozygous SNP ratio, should reveal a peak in the non-recombinant region, because of the high density of homozygous SNPs in that location (there is a consistent distribution of heterozygous SNPs from the mapping line across the genome). The causative SNP should be located at the peak of this ratio distribution.</p>

<h3>
<a name="creating-a-model-genome" class="anchor" href="#creating-a-model-genome"><span class="octicon octicon-link"></span></a>Creating a model genome</h3>

<p>Running: <code>ruby create_model_genome.rb dataset_name</code> will generate a new model genome of that name based on Arabidopsis chromosome 4 and the experiment detailed above, in fragmented_genome_with_snps/arabidopsis_datasets. This includes a FASTA file with the sequences of each fragment, and a VCF file with the SNPs on each fragment. In the INFO field of the VCF, each SNP has been given an allele frequency (AF). Heterozygous SNPs will generally have AF = ~0.5, and homozygous AF = ~1.0, but this will vary with pooled data. In the model, each SNP has been given an allele frequency of exactly 0.5 or 1.0. The <code>dataset_name</code> argument specifies the name of the directory to create and store the files in. In <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/create_model_genome.rb">create_model_genome.rb</a>, this currently places that directory: <code>"~/fragmented_genome_with_snps/arabidopsis_datasets/dataset_name"</code> (but this can of course be altered).</p>

<p>By editing <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/create_model_genome.rb">create_model_genome.rb</a>, the features of the model genome created by it can be altered. The variables <code>hm_r</code> and <code>ht_r</code> contain the R code needed to create the model homozygous and heterozygous SNP distributions respectively. The variable <code>contig_size</code> provides the minimum size for contigs, where the maximum size is double this value, and each contig's size is randomly chosen within this range. The <code>fasta_file</code> variable points to a FASTA format file with one chromosome, which in this case is <em>Arabidopsis thaliana</em> chromosome 4. This chromosome forms the basis of my model genome. Fragments (contigs) of the input FASTA file are created, and the SNPs are applied to them. A new FASTA file is created with the contigs randomly ordered, and a VCF file is created. These serve as the starting files for my algorithm. I have also included a number of other useful output files: the FASTA file with the contigs ordered correctly, txt files that list the homozygous and heterozygous SNPs, and another txt file (info.txt) that records the values of <code>hm_r</code>, <code>ht_r</code> and <code>contig_size</code>.</p>

<p>Why not use real data straight away?</p>

<ul>
<li>With model data, I know the location of the causative mutation and the correct order of the fragments. This means I can tell whether or not my algorithm works.</li>
<li>I can generate datasets that model different experiments/sample data quickly: e.g. different fragment sizes, different SNP distributions, different experiment</li>
</ul><h2>
<a name="re-ordering-the-genome" class="anchor" href="#re-ordering-the-genome"><span class="octicon octicon-link"></span></a>Re-ordering the Genome</h2>

<p>I aim to use a <strong>genetic algorithm</strong> to rearrange contigs, and find a permutation of the contig order that has the correct homozygous/heterozygous SNP ratio distribution. Permutations with distributions close to the expected, are likely be ordered in an arrangement close to the correct. The algorithm I am creating will eventually be capable of determining the location of the causative mutation, in a genome from the experiment detailed above. The algorithm will take a FASTA file with the unordered genome fragments (contigs), and a VCF file containing the SNP positions for each fragment.</p>

<h3>
<a name="genetic-algorithm" class="anchor" href="#genetic-algorithm"><span class="octicon octicon-link"></span></a>Genetic Algorithm</h3>

<p>A genetic algorithm is a kind of iterative improvement algorithm. These are where an initial starting solution to a problem is incrementally improved, in order to reach an eventual perfect solution. In the case of a permutation problem, like my contig rearrangement, it is the <em>ordering</em> of elements (contigs) that needs to be changed until correct.</p>

<p>Genetic algorithms are based on the principles of natural selection. A "population" of solutions is created, and those with the highest "fitness" (correctness) are selected. New "offspring" solutions can be created through recombination of the components of "parent" solutions, and "mutations" can be introduced by creating novel components or parameters. If subsequent populations are created by the recombination of selected members of the current population, and/or the introduction of mutant solutions, the best solutions in each generation will be better than the best solutions from the previous generation. In this way, the perfect solution (in this case the perfect permutation of contig order) will eventually be reached.</p>

<p>With my model genome, I know the correct permutation of fragments/contigs (I have named each frag1, frag2...), so I am able to see if the algorithm has arranged them correctly (see 'Assesing the algorithms performance' below). I give each permutation of the fragment order created by the algorithm, a fitness score based on it's homozygous and heterozygous SNP distributions.</p>

<h3>
<a name="mutation" class="anchor" href="#mutation"><span class="octicon octicon-link"></span></a>Mutation</h3>

<p>In my genetic algorithm, I use mutation methods to rearrange the contigs into novel permutations. The mutation methods used are from my <a href="https://github.com/edwardchalstrey1/pmeth">PMeth ruby gem</a>. The repo provides a description of what they do.
In each generation of my genetic algorithm, I create mutants of permutations from the previous generation.</p>

<h3>
<a name="permutation-fitness" class="anchor" href="#permutation-fitness"><span class="octicon octicon-link"></span></a>Permutation Fitness</h3>

<p>Genetic algorithms require a fitness method, in order to tell how close each solution comes to solving the given problem. With a permutation problem, the fitness method should score the permutation based on how correct the ordering of elements is. I have tested several different fitness methods. Each of these makes a slightly different assumption about the SNP distributions of the genome.</p>

<p>For a detailed look at how the fitness methods work, see <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Documentation/fitness_methods/fitness_methods.md">Documentation/fitness</a></p>

<h3>
<a name="quit-condition" class="anchor" href="#quit-condition"><span class="octicon octicon-link"></span></a>Quit condition</h3>

<p>A genetic algorithm needs a way of knowing when to stop. Ideally, you want it to continue until a correct solution has been reached, but in reality this may be impossible. I have implemented a <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Quit_condition/quit_condition.md">quit condition</a> that terminates my genetic algorithm, when improvement (in fitness) is judged to be negligible.</p>

<h2>
<a name="how-my-genetic-algorithm-works" class="anchor" href="#how-my-genetic-algorithm-works"><span class="octicon octicon-link"></span></a>How my genetic algorithm works</h2>

<p>The <code>evolve</code> method in the <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/lib/GATOC.rb">GATOC class</a> is a wrapper method that forms the bulk of my genetic algorithm. A script is required to call <code>GATOC.evolve</code>, and whilst testing the algorithm I have been using <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/algorithm_test.rb">algorithm_test.rb</a>.</p>

<p>To run <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/algorithm_test.rb">algorithm_test.rb</a>: <code>ruby algorithm_test.rb dataset_name run</code>, where <code>dataset_name</code> is the same as the one used to create the model genome, and <code>run</code> is the name of the directory in which to save results. Subsequent required command line parameters are described in <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/algorithm_test.rb">algorithm_test.rb</a>: these correspond to input parameters for <code>GATOC.evolve</code>.</p>

<p>When running the algorithm with real data, a new ruby script will be needed to call <code>GATOC.evolve</code></p>

<p>For a detailed look at how the algorithm works see <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Documentation/evolve.md">Documentation/evolve</a></p>

<h2>
<a name="assesing-the-genetic-algorithms-performance" class="anchor" href="#assesing-the-genetic-algorithms-performance"><span class="octicon octicon-link"></span></a>Assesing the Genetic Algorithm's performance</h2>

<p>My experiment relies on the premise that the fitness of a permutation, as I have calculated it, is related to how close that permutation is to the correct arrangement of contigs. To test this, I use a number of distance metrics, which compare the order of permutations and provide a similarity score. I have made a ruby gem called <a href="https://github.com/edwardchalstrey1/pdist">PDist</a> that contains the methods for calculating these scores. Descriptions of how they work can be found in the repository.</p>

<h3>
<a name="testing-the-algorithms-fitness-methods-and-the-distance-metrics-from-pdist" class="anchor" href="#testing-the-algorithms-fitness-methods-and-the-distance-metrics-from-pdist"><span class="octicon octicon-link"></span></a>Testing the algorithms fitness methods, and the distance metrics from PDist</h3>

<p>I have carried out an experiment to determine which of the fitness methods I have come up with are most worth pursuing, and which distance metrics (from  <a href="https://github.com/edwardchalstrey1/pdist">PDist</a>) are most useful for analysing my results. For my findings, see <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Do_metrics_work/do_metrics_work.md">Progress/Do_metrics_work</a>.</p>

<h3>
<a name="data-analysis" class="anchor" href="#data-analysis"><span class="octicon octicon-link"></span></a>Data analysis</h3>

<p>For information on how I analysed the output from my algorithm see <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Documentation/analysis/analysis.md">Documentation/analysis</a></p>

<h3>
<a name="candidates-for-the-causative-snp-mutation" class="anchor" href="#candidates-for-the-causative-snp-mutation"><span class="octicon octicon-link"></span></a>Candidates for the causative SNP mutation</h3>

<p>For information on how I worked out candidates for the causative SNP mutation, see <a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Documentation/causal_mutation/causal_mutation.md">Documentation/causal_mutation</a></p>

<h2>
<a name="results" class="anchor" href="#results"><span class="octicon octicon-link"></span></a>Results</h2>

<p>Below are the results of running many replicates of my algorithm with different fitness methods.</p>

<p><a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Results1_count_ratio/results.md">Results for count_ratio fitness method</a></p>

<p><a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Results2_snp_distance/results.md">Results for snp_distance fitness method</a></p>

<p><a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Results3_max_density/results.md">Results for max_density fitness method</a></p>

<p><a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Results4_max_ratio/results.md">Results for max_ratio fitness method</a></p>

<p><a href="https://github.com/edwardchalstrey1/fragmented_genome_with_snps/blob/master/Progress/Results5_max_hyp/results.md">Results for max_hyp fitness method</a></p>

<h2>
<a name="project-dependencies" class="anchor" href="#project-dependencies"><span class="octicon octicon-link"></span></a>Project dependencies</h2>

<ol>
<li>Ruby &gt;= 2.0.0</li>
<li>Ruby gems:

<ul>
<li>pmeth &gt;= 1.0.0</li>
<li>pdist &gt;= 0.0.5</li>
<li>bio &gt;= 1.4.3.0001</li>
<li>bio-samtools &gt;= 2.0.5</li>
<li>rinruby &gt;= 2.0.3</li>
</ul>
</li>
<li>R &gt;= 3.0.1</li>
<li>R packages:

<ul>
<li>pracma &gt;= 1.6.4</li>
<li>ggplot2 &gt;= 0.9.3.1</li>
</ul>
</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">GATOC (Genetic Algorithm To Order Contigs) maintained by <a href="https://github.com/edwardchalstrey1">edwardchalstrey1</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
